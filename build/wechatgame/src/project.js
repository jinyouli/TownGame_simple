require=function s(r,a,c){function l(e,t){if(!a[e]){if(!r[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(u)return u(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var o=a[e]={exports:{}};r[e][0].call(o.exports,function(t){return l(r[e][1][t]||t)},o,o.exports,s,r,a,c)}return a[e].exports}for(var u="function"==typeof require&&require,t=0;t<c.length;t++)l(c[t]);return l}({build_menu:[function(t,e,n){"use strict";cc._RF.push(e,"e52e8Wwxi9HqJtnmZ7LcCp/","build_menu");var i,o=t("./global"),s=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{},start:function(){},buttonClick:function(t,e){cc.log("test"+e),s.default.event.fire("build_tower",e)}}),cc._RF.pop()},{"./global":"global"}],bullet:[function(t,e,n){"use strict";cc._RF.push(e,"1ca12khC69EaZ1Wrk5lPLro","bullet"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.direction=cc.p(0,1),this.speed=300},initWithData:function(t,e,n){this.direction=cc.pNormalize(cc.pSub(e,t.position)),this.node.position=cc.pAdd(t.position,cc.pMult(this.direction,100));var i=cc.pAngleSigned(this.direction,cc.p(0,1));this.node.rotation=180/Math.PI*i,this.enemyNodeList=n,this.damage=t.getComponent("tower").getDamage()},update:function(t){this.node.position=cc.pAdd(this.node.position,cc.pMult(this.direction,this.speed*t));for(var e=0;e<this.enemyNodeList.length;e++){var n=this.enemyNodeList[e];if(n)if(n.getComponent("enemy").isLiving())cc.pDistance(n.position,this.node.position)<.5*n.width+.5*this.node.width&&(n.getComponent("enemy").beAttacked(this.damage),this.node.destroy())}(this.node.position.x<-960||960<this.node.position.x||540<this.node.position.y||this.node.position.y<-540)&&this.node.destroy()}}),cc._RF.pop()},{}],enemy:[function(t,e,n){"use strict";cc._RF.push(e,"a110eflr9hKmLpOJ0pVULVc","enemy");var i=-1,s=1,o=2,r=3;cc.Class({extends:cc.Component,properties:{spriteFrames:{default:[],type:cc.SpriteFrame},lifeProgressBar:{default:null,type:cc.ProgressBar}},onLoad:function(){this.state=i,this.node.opacity=0,this.currentPathCount=0,this.currentHealth=0,this.totalHealth=1},initWithData:function(i,t){var o=this;this.node.getComponent(cc.Sprite).spriteFrame=this.spriteFrames[i],this.partPointer=t,this.node.position=this.partPointer[0].position,cc.loader.loadRes("./enemy_config",function(t,e){if(t)cc.log("err == "+t);else{var n=e["enemy_"+i];o.speed=n.speed,o.currentHealth=n.health,o.totalHealth=n.health,o.setState(s)}})},update:function(t){if(this.state==s)if(cc.pDistance(this.node.position,this.partPointer[this.currentPathCount].position)<10){if(this.currentPathCount++,this.currentPathCount>=this.partPointer.length)return void this.setState(o);this.direction=cc.pNormalize(cc.pSub(this.partPointer[this.currentPathCount].position,this.node.position))}else this.node.position=cc.pAdd(this.node.position,cc.pMult(this.direction,this.speed*t));this.lifeProgressBar.progress=this.currentHealth/this.totalHealth},setState:function(t){if(this.state!=t){switch(t){case s:this.node.opacity=255;break;case r:var e=cc.fadeOut(1),n=cc.sequence(e,cc.callFunc(function(){console.log("call func actin!!!"),this.node.destroy()},this));this.node.runAction(n)}this.state=t}},isLiving:function(){return this.state==s},isDead:function(){return this.state==r},beAttacked:function(t){this.currentHealth-=t,this.currentHealth<0&&(this.currentHealth=0,this.setState(r))}}),cc._RF.pop()},{}],event_listener:[function(t,e,n){"use strict";cc._RF.push(e,"242a4I/fJVKkriFyUCOaUys","event_listener"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function(t){var r=[];return t.on=function(t,e){r.hasOwnProperty(t)||(r[t]=[]),r[t].push(e)},t.fire=function(t){if(r.hasOwnProperty(t))for(var e=r[t],n=0;n<e.length;n++){for(var i=e[n],o=[],s=1;s<arguments.length;s++)o.push(arguments[s]);i.apply(this,o)}},t.off=function(t,e){if(r.hasOwnProperty(t))for(var n=r[t],i=0;i<n.length;i++)n[i]==e&&n.splice(i,1)},t},e.exports=n.default,cc._RF.pop()},{}],gameUILayer:[function(t,e,n){"use strict";cc._RF.push(e,"b8ae9A2c2dI75JZAFb3c5NW","gameUILayer");var i,o=t("./global"),s=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{limitTimeLabel:{default:null,type:cc.Label}},onLoad:function(){this.nowTime=4},update:function(t){0<this.nowTime&&(this.nowTime-=t,this.nowTime-Math.floor(this.nowTime)<.1&&(this.limitTimeLabel.string=Math.floor(this.nowTime),0==Math.floor(this.nowTime)&&(this.limitTimeLabel.string="",this.nowTime=0,s.default.event.fire("game_start"))))}}),cc._RF.pop()},{"./global":"global"}],game_world:[function(t,e,n){"use strict";cc._RF.push(e,"f7580yl2R1MVp1tjt3dJdeB","game_world"),cc.Class({extends:cc.Component,properties:{levelPrefab:{default:[],type:cc.Prefab},gameLayerNode:{default:null,type:cc.Node},gameUILayerNode:{default:null,type:cc.Node}},onLoad:function(){cc.instantiate(this.levelPrefab[0]).parent=this.gameLayerNode},update:function(t){}}),cc._RF.pop()},{}],global:[function(t,e,n){"use strict";cc._RF.push(e,"0dbc87nfg5O+oh9lNbjN8kJ","global"),Object.defineProperty(n,"__esModule",{value:!0});var i,o=t("./event_listener"),s=(i=o)&&i.__esModule?i:{default:i};var r=r||[];r.event=(0,s.default)([]),n.default=r,e.exports=n.default,cc._RF.pop()},{"./event_listener":"event_listener"}],level:[function(t,e,n){"use strict";cc._RF.push(e,"95b9d2UkWxG2LqlahSMKL0F","level");var i,o=t("./global"),s=(i=o)&&i.__esModule?i:{default:i};var r=1,a=2,c=3,l=4;cc.Class({extends:cc.Component,properties:{enemyPathNodes:{default:[],type:cc.Node},towerPosNodes:{default:[],type:cc.Node},buildTowerPrefab:{default:null,type:cc.Prefab},towerPrefab:{default:[],type:cc.Prefab},updateTowerPrefab:{default:null,type:cc.Prefab},enemyPrefab:{default:null,type:cc.Prefab},bulletPrefab:{default:null,type:cc.Prefab}},onLoad:function(){for(var t=0;t<this.towerPosNodes.length;t++){var e=this.towerPosNodes[t];this.setState(e,r),this.setTouchEvent(e)}s.default.event.on("build_tower",this.buildTower.bind(this)),s.default.event.on("update_tower",this.updateTower.bind(this)),s.default.event.on("sell_tower",this.sellTower.bind(this)),s.default.event.on("game_start",this.gameStart.bind(this)),s.default.event.on("addBullet",this.addBullet.bind(this)),this.currentWaveCount=0,this.enemyCount=0,this.addEnemyTime=0,this.addWaveCurrentTime=0,this.enemyNodeList=[]},setTouchEvent:function(e){e.on(cc.Node.EventType.TOUCH_START,function(t){cc.log("touch node name == "+t.target.name),e.state==r?this.showBuildMenu(t.target):e.state==c&&this.showUpdateMenu(t.target)},this)},showBuildMenu:function(t){if(this.closeMenu(),t.state==r){var e=cc.instantiate(this.buildTowerPrefab);e.parent=this.node,e.position=t.position,this.setState(t,a),t.menu=e}},showUpdateMenu:function(t){this.closeMenu();var e=cc.instantiate(this.updateTowerPrefab);e.parent=this.node,e.position=t.position,this.setState(t,l),t.menu=e},closeMenu:function(){for(var t=0;t<this.towerPosNodes.length;t++){var e=this.towerPosNodes[t];if(e.state==a)return e.menu.destroy(),this.setState(e,r),e;if(e.state==l)return e.menu.destroy(),this.setState(e,c),e}},setState:function(t,e){t.state!=e&&(t.state=e)},buildTower:function(t){cc.log("build tower "+t);var e=this.closeMenu(),n=cc.instantiate(this.towerPrefab[t]);n.parent=this.node,n.position=e.position,this.setState(e,c),e.tower=n},onDestory:function(){s.default.event.off("build_tower",this.buildTower)},updateTower:function(){this.closeMenu().tower.getComponent("tower").updateTower()},sellTower:function(){var t=this.closeMenu();t.tower.getComponent("tower").sellTower(),this.setState(t,r),t.tower=void 0},gameStart:function(){var o=this;cc.loader.loadRes("./level_config",function(t,e){if(t)cc.log("load err = "+t);else{cc.log("load config = ",JSON.stringify(e));var n=e.level_1,i=n.waves;o.config=n,o.wavesConfig=i,o.currentWaveConfig=i[o.currentWaveCount]}})},addWave:function(){},addEnemy:function(t){cc.log("add type == "+t);var e=cc.instantiate(this.enemyPrefab);e.getComponent("enemy").initWithData(t,this.enemyPathNodes),e.parent=this.node,this.enemyNodeList.push(e)},addBullet:function(t,e){var n=cc.instantiate(this.bulletPrefab);n.position=t.position,n.parent=this.node,n.getComponent("bullet").initWithData(t,e,this.enemyNodeList)},update:function(t){if(this.currentWaveConfig)this.addEnemyTime>this.currentWaveConfig.dt?(this.addEnemyTime=0,this.enemyCount++,this.addEnemy(this.currentWaveConfig.type),this.enemyCount>=this.currentWaveConfig.count&&(this.currentWaveConfig=void 0,this.enemyCount=0)):this.addEnemyTime+=t;else{this.config&&(this.addWaveCurrentTime>this.config.dt?(this.currentWaveConfig=this.wavesConfig[this.currentWaveCount],this.currentWaveCount<this.wavesConfig.length?this.currentWaveCount++:this.currentWaveConfig=void 0,this.addWaveCurrentTime=0):this.addWaveCurrentTime+=t);for(var e=0;e<this.towerPosNodes.length;e++){var n=this.towerPosNodes[e].tower;if(null!=n)for(var i=0;i<this.enemyNodeList.length;i++){var o=this.enemyNodeList[i];o.getComponent("enemy").isLiving()?n.getComponent("tower").setEnemy(o):o.getComponent("enemy").isDead()&&this.enemyNodeList.splice(i,1)}}}}}),cc._RF.pop()},{"./global":"global"}],tower:[function(t,e,n){"use strict";cc._RF.push(e,"99bbez/HJJGMJzlG06jhbwI","tower");var i,o=t("./global"),s=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{spriteFrames:{default:[],type:cc.SpriteFrame},towerType:""},onLoad:function(){var n=this;this.levelCount=0,this.currentDamage=0,this.lookRange=0,this.currentAttackRange=0,this.shootBulletDt=0,this.currentBulletDt=0,cc.loader.loadRes("./tower_config",function(t,e){t?cc.log("err = "+t):(cc.log("success = "+JSON.stringify(e)),n.towerConfig=e[n.towerType],n.currentDamage=n.towerConfig.damage[n.levelCount],n.currentAttackRange=n.towerConfig.actack_range[n.levelCount],n.lookRange=n.towerConfig.look_range,n.shootBulletDt=n.towerConfig.shoot_dt[n.levelCount])})},updateTower:function(){this.levelCount<this.spriteFrames.length-1?(this.levelCount++,this.node.getComponent(cc.Sprite).spriteFrame=this.spriteFrames[this.levelCount],this.currentDamage=this.towerConfig.damage[this.levelCount],this.currentAttackRange=this.towerConfig.actack_range[this.levelCount],this.lookRange=this.towerConfig.look_range):cc.log("满级")},sellTower:function(){this.node.destroy()},isAttack:function(){return null==this.enemy},setEnemy:function(t){cc.pDistance(t.position,this.node.position)<400&&(this.enemy=t)},update:function(t){if(null!=this.enemy){var e=cc.pSub(this.enemy.position,this.node.position),n=cc.pAngleSigned(e,cc.p(0,1));this.node.rotation=180/Math.PI*n,this.currentBulletDt>this.shootBulletDt?(this.currentBulletDt=0,this.shootBullet()):this.currentBulletDt+=t,cc.pDistance(this.enemy.position,this.node.position)>this.currentAttackRange&&0==this.enemy.getComponent("enemy").isLiving()&&(this.enemy=void 0)}},shootBullet:function(){s.default.event.fire("addBullet",this.node,this.enemy.position)},getDamage:function(){return this.currentDamage}}),cc._RF.pop()},{"./global":"global"}],update_menu:[function(t,e,n){"use strict";cc._RF.push(e,"883344yjFtJb7H6sPmy49dy","update_menu");var i,o=t("./global"),s=(i=o)&&i.__esModule?i:{default:i};cc.Class({extends:cc.Component,properties:{},start:function(){},buttonClick:function(t,e){cc.log("click == "+e),s.default.event.fire(e+"_tower")}}),cc._RF.pop()},{"./global":"global"}]},{},["build_menu","bullet","enemy","event_listener","gameUILayer","game_world","global","level","tower","update_menu"]);
{"version":3,"sources":["tower.js"],"names":["cc","Class","extends","Component","properties","spriteFrames","default","type","SpriteFrame","towerType","onLoad","levelCount","currentDamage","lookRange","currentAttackRange","loader","loadRes","err","result","log","JSON","stringify","towerConfig","damage","actack_range","look_range","updateTower","length","node","getComponent","Sprite","spriteFrame","sellTower","destroy","isAttack","enemy","undefined","setEnemy","distance","pDistance","position","update","dt","direction","pSub","angle","pAngleSigned","p","rotation","Math","PI"],"mappings":";;;;;;AACAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,sBAAe;AACXC,qBAAU,EADC;AAEXC,kBAAMP,GAAGQ;AAFE,SADP;;AAMRC,mBAAY;AANJ,KAHP;;AAYLC,YAAQ,kBAAU;AAAA;;AACd,aAAKC,UAAL,GAAkB,CAAlB;AACA,aAAKC,aAAL,GAAqB,CAArB;AACA,aAAKC,SAAL,GAAiB,CAAjB;AACA,aAAKC,kBAAL,GAA0B,CAA1B;;AAEAd,WAAGe,MAAH,CAAUC,OAAV,CAAkB,gBAAlB,EAAmC,UAACC,GAAD,EAAMC,MAAN,EAAe;AAC9C,gBAAID,GAAJ,EAAS;AACLjB,mBAAGmB,GAAH,CAAO,WAAWF,GAAlB;AACH,aAFD,MAEM;AACFjB,mBAAGmB,GAAH,CAAO,eAAeC,KAAKC,SAAL,CAAeH,MAAf,CAAtB;AACA,sBAAKI,WAAL,GAAmBJ,OAAO,MAAKT,SAAZ,CAAnB;AACA,sBAAKG,aAAL,GAAqB,MAAKU,WAAL,CAAiBC,MAAjB,CAAwB,MAAKZ,UAA7B,CAArB;AACA,sBAAKG,kBAAL,GAA0B,MAAKQ,WAAL,CAAiBE,YAAjB,CAA8B,MAAKb,UAAnC,CAA1B;AACA,sBAAKE,SAAL,GAAiB,MAAKS,WAAL,CAAiBG,UAAlC;AACH;AACJ,SAVD;AAWH,KA7BI;;AA+BLC,iBAAa,uBAAW;AACpB,YAAI,KAAKf,UAAL,GAAkB,KAAKN,YAAL,CAAkBsB,MAAlB,GAA2B,CAAjD,EAAoD;AAChD,iBAAKhB,UAAL;AACA,iBAAKiB,IAAL,CAAUC,YAAV,CAAuB7B,GAAG8B,MAA1B,EAAkCC,WAAlC,GAAgD,KAAK1B,YAAL,CAAkB,KAAKM,UAAvB,CAAhD;;AAEA,iBAAKC,aAAL,GAAqB,KAAKU,WAAL,CAAiBC,MAAjB,CAAwB,KAAKZ,UAA7B,CAArB;AACA,iBAAKG,kBAAL,GAA0B,KAAKQ,WAAL,CAAiBE,YAAjB,CAA8B,KAAKb,UAAnC,CAA1B;AACA,iBAAKE,SAAL,GAAiB,KAAKS,WAAL,CAAiBG,UAAlC;AACH,SAPD,MAQK;AACDzB,eAAGmB,GAAH,CAAO,IAAP;AACH;AACJ,KA3CI;;AA6CLa,eAAW,qBAAW;AAClB,aAAKJ,IAAL,CAAUK,OAAV;AACH,KA/CI;;AAiDLC,cAAU,oBAAW;AACjB,YAAI,KAAKC,KAAL,IAAcC,SAAlB,EAA6B;AACzB,mBAAO,IAAP;AACH;;AAED,eAAO,KAAP;AACH,KAvDI;;AAyDLC,cAAU,kBAAUF,KAAV,EAAgB;;AAEtB,YAAIG,WAAWtC,GAAGuC,SAAH,CAAaJ,MAAMK,QAAnB,EAA4B,KAAKZ,IAAL,CAAUY,QAAtC,CAAf;;AAEA,YAAIF,WAAW,GAAf,EAAoB;AAChB,iBAAKH,KAAL,GAAaA,KAAb;AACH;AACD,aAAKA,KAAL,GAAaA,KAAb;AACH,KAjEI;;AAmELM,YAAS,gBAASC,EAAT,EAAY;AACjB,YAAG,KAAKP,KAAL,IAAcC,SAAjB,EAA2B;AACvB,gBAAIO,YAAY3C,GAAG4C,IAAH,CAAQ,KAAKT,KAAL,CAAWK,QAAnB,EAA6B,KAAKZ,IAAL,CAAUY,QAAvC,CAAhB;;AAEA,gBAAIK,QAAQ7C,GAAG8C,YAAH,CAAgBH,SAAhB,EAA2B3C,GAAG+C,CAAH,CAAK,CAAL,EAAO,CAAP,CAA3B,CAAZ;AACA,iBAAKnB,IAAL,CAAUoB,QAAV,GAAsB,MAAMC,KAAKC,EAAZ,GAAkBL,KAAvC;AAGH;AACJ;;AA5EI,CAAT","file":"tower.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        spriteFrames : {\n            default : [],\n            type: cc.SpriteFrame\n        },\n\n        towerType : \"\"\n    },\n\n    onLoad: function(){\n        this.levelCount = 0;\n        this.currentDamage = 0;\n        this.lookRange = 0;\n        this.currentAttackRange = 0;\n\n        cc.loader.loadRes(\"./tower_config\",(err, result)=>{\n            if (err) {\n                cc.log(\"err = \" + err);\n            }else {\n                cc.log(\"success = \" + JSON.stringify(result));\n                this.towerConfig = result[this.towerType];\n                this.currentDamage = this.towerConfig.damage[this.levelCount];\n                this.currentAttackRange = this.towerConfig.actack_range[this.levelCount];\n                this.lookRange = this.towerConfig.look_range;\n            }\n        });\n    },\n\n    updateTower: function (){\n        if (this.levelCount < this.spriteFrames.length - 1) {\n            this.levelCount ++;\n            this.node.getComponent(cc.Sprite).spriteFrame = this.spriteFrames[this.levelCount];\n\n            this.currentDamage = this.towerConfig.damage[this.levelCount];\n            this.currentAttackRange = this.towerConfig.actack_range[this.levelCount];\n            this.lookRange = this.towerConfig.look_range;\n        }\n        else {\n            cc.log(\"满级\");\n        }\n    },\n\n    sellTower: function (){\n        this.node.destroy();\n    },\n\n    isAttack: function (){\n        if (this.enemy == undefined) {\n            return true;\n        };\n\n        return false;\n    },\n\n    setEnemy: function (enemy){\n\n        let distance = cc.pDistance(enemy.position,this.node.position);\n\n        if (distance < 200) {\n            this.enemy = enemy;\n        };  \n        this.enemy = enemy;      \n    },\n\n    update : function(dt){\n        if(this.enemy != undefined){\n            let direction = cc.pSub(this.enemy.position, this.node.position);\n\n            let angle = cc.pAngleSigned(direction, cc.p(0,1));\n            this.node.rotation = (180 / Math.PI) * angle;\n\n            \n        }\n    }\n\n});\n\n\n\n\n\n\n\n\n\n"]}